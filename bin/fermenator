#!/usr/bin/env python
"""
fermenator - monitor and manage fermentation

Usage:
  fermenator run <google_sheet_id> [options]
  fermenator -h | --help
  fermenator --version

Options:
  -h --help         Show this screen.
  --version         Show version.
  -v, --verbose     Enable verbose output logging
  -x, --xtra-verbose  Enable super-verbose logging
  -l, --logfile=<x>  Log to the specified file instead of screen
  -r, --refresh=<n>  Set interval for config change polling [default: 300]
"""
from docopt import docopt
import logging

logging.captureWarnings(True)

from fermenator.config import GoogleSheetConfig

def main():
    args = docopt(__doc__, version="fermenator 0.1")

    root_logger = logging.getLogger()
    ferm_logger = logging.getLogger('fermenator')
    if args['--verbose'] or args['--xtra-verbose']:
        ferm_logger.setLevel(logging.DEBUG)
    else:
        ferm_logger.setLevel(logging.INFO)

    if args['--xtra-verbose']:
        root_logger.setLevel(logging.DEBUG)
    else:
        root_logger.setLevel(logging.WARN)

    log_format = "%(asctime)s %(levelname)-8s %(name)s %(message)s"
    formatter = logging.Formatter(log_format)

    ch = logging.StreamHandler()
    ch.setLevel(logging.DEBUG)
    ch.setFormatter(formatter)
    root_logger.addHandler(ch)

    if args['--logfile']:
        fh = logging.FileHandler(args['--logfile'])
        fh.setLevel(logging.DEBUG)
        fh.setFormatter(formatter)
        root_logger.addHandler(fh)

    GoogleSheetConfig(
        'MAIN',
        refresh_interval=float(args['--refresh']),
        config_spreadsheet_id=args['<google_sheet_id>']
    ).run()

if __name__ == "__main__":
    main()
